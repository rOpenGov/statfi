<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{An R Markdown Vignette made with knitr}
-->

Statistics Finland (Tilastokeskus) R tools
===========

This is the rOpenGov [statfi](http://ropengov.github.com/statfi) R
package to access data from [Statistics
Finland](http://www.stat.fi/org/lainsaadanto/avoin_data.html) and
[Eurostat]().


### Installation

Release version for general users:

```{r install, eval=FALSE}
install.packages("statfi")
library(statfi)
```

Development version for developers:

```{r install2, eval=FALSE}
install.packages("devtools")
library(devtools)
install_github("statfi", "ropengov")
library(statfi)
```

Further installation and development instructions at the [home
page](http://ropengov.github.com/statfi). For further usage examples,
see [Louhos-blog](http://louhos.wordpress.com) and
[Datawiki](https://github.com/ropengov/statfi/wiki/Data), and
[takomo](https://github.com/louhos/takomo/tree/master/StatFi).


### Statistics Finland and Eurostat open data listing

The listing of [open data sets from Statistics Finland (StatFi) and
Eurostat](http://www.stat.fi/org/lainsaadanto/avoin_data.html) are
available for browsing:

 * [StatFi (CSV)](http://pxweb2.stat.fi/database/StatFin/StatFin_rap_csv.csv)
 * [StatFi (XML)](http://pxweb2.stat.fi/database/StatFin/StatFin_rap_xml.csv)
 * [Eurostat](http://pxweb2.stat.fi/database/StatFin/StatFin_rap.csv)

You can download these listings in R as follows:

```{r tilastokeskus-1, warning=FALSE, message=FALSE}
# Load the library
library(statfi)

# List the open data files available from Statistics Finland
datasets.statfi <- list_statfi_files()

# List the open data files available from Eurostat
datasets.eurostat <- list_eurostat_files()

# Investigate the first entry in StatFi data
print(datasets.statfi[1,])

# EuroStat data files, descriptions of the first entries
head(datasets.eurostat$DESCRIPTION)
```

### Median incomes in Finnish municipalities

```{r tilastokeskus-2, warning=FALSE, message=FALSE}
library(statfi)

# Define URL (see datasets.statfi)
url <- "http://pxweb2.stat.fi/Database/StatFin/tul/tvt/2009/120_tvt_2009_2011-02-18_tau_112_fi.px"

# Get the data
df <- get_statfi(url)
head(df)
```

### Visualizing PC Axis data

See also the example in [Louhos blog](https://louhos.wordpress.com/2011/10/19/tilastokeskuksen-pc-axis-muotoisten-aineistojen-visualisointi-suomen-kartalla/). 

```{r tilastokeskus-3, warning=FALSE, message=FALSE}
library(sorvi)

# Get Finnish municipality borders (C) Maanmittauslaitos 2011
# http://www.maanmittauslaitos.fi/aineistot-palvelut/digitaaliset-tuotteet/ilmaiset-aineistot/hankinta
sp <- LoadMML(data.id = "kunta1_p", resolution = "1_milj_Shape_etrs_shape") 

# Pick information from statfi data
mediaanitulo <- subset(df, Tiedot == "Veronalaiset tulot, mediaani" & Vuosi == 2009)

# Lisaa tiedot karttaobjektiin
sp@data$mediaanitulo <- mediaanitulo$dat[match(sp$Kunta.FI, mediaanitulo$Kunta)]
# Korvaa puuttuvat arvot nollalla
sp[["mediaanitulo"]][is.na(sp[["mediaanitulo"]])] <- 0

# Visualize
varname <- "mediaanitulo"
int <- max(abs(sp[[varname]]))
q <- PlotShape(sp, varname, type = "oneway",
main = "Median income",
at = seq(-1, int, length = 11))
```


# Licensing and Citations

### Statistics Finland data

Cite Statfi and link to
[http://www.statfi.fi](http://www.statfi.fi/).

### statfi R package

This work can be freely used, modified and distributed under the
[Two-clause FreeBSD
license](http://en.wikipedia.org/wiki/BSD\_licenses). Kindly cite the
R package as 'Leo Lahti, Juuso Parkkinen ja Joona LehtomÃ¤ki
(2010-2013). statfi R package. URL:
http://ropengov.github.io/statfi'.


### Session info


This vignette was created with

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```
